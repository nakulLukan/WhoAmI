@using WhoAmI.Web.Interfaces
@inject NavigationManager NavigationManager
<style>
    h1 {
        position: fixed;
    }

    nav {
        top: 0px;
        position: fixed;
        width: 100%;
        height: 80px;
    }

        nav div {
            height: 100%;
            overflow: hidden;
            background: #333333;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }

    .nav-container {
        width: 100%;
        margin-left: auto;
        margin-right: auto;
        transition: width 0.5s;
    }

    .nav-container-none {
        width: 0%;
        margin-left: auto;
        margin-right: auto;
        transition: width 0.5s;
    }

    .nav-container-center {
        z-index: 1000;
        width: 50%;
        margin-left: auto;
        margin-right: auto;
        transition: width 0.5s;
    }

    .logo-3d {
        width: auto;
        height: 80px;
        cursor: grab;
    }

    .logo-3d:active{
        cursor: grabbing;
    }

    nav div .logo {
        color: white;
        font-size: 35px;
        line-height: 80px;
        font-weight: bold;
    }

    nav div ul {
        float: right;
        list-style: none;
        margin: 0px;
    }

        nav div ul li {
            display: inline;
            line-height: 80px;
            margin: 0 5px;
        }

            nav div ul li a {
                color: white;
                font-size: 17px;
                text-transform: uppercase;
                border-radius: 3px;
                padding: 7px 13px;
                text-decoration: none;
                cursor: pointer;
            }

    a.active, a:hover {
        transition: 0.5s;
        text-decoration: underline;
        text-underline-offset: 4px;
        color: white;
    }

    a.active {
        color: white;
        font-weight: bold;
    }
</style>
<nav>
    <div class=@navClass>
        <BabylonSharp Class="logo-3d" Id="nav-canvas" AssetName="suzane.babylon"></BabylonSharp>
        <ul>
            <li>
                <a class=@(IsActiveMenu(MenuItem.Work) ? "active" : string.Empty)
                   @onclick="@(()=> MenuItemClick(MenuItem.Work))">Work</a>
            </li>

            <li>
                <a class=@(IsActiveMenu(MenuItem.About) ? "active" : string.Empty)
                   @onclick="@(()=> MenuItemClick(MenuItem.About))">About</a>
            </li>
        </ul>
    </div>
</nav>
@code {
    [Inject]
    IJSRuntime jsrunTime { get; set; }

    [Inject]
    IBrowserService browserService { get; set; }

    enum MenuItem
    {
        Work,
        About
    }

    private const string NAV_CONTAINER_CLASS = "nav-container";
    private const string NAV_CONTAINER_CENTER_CLASS = "nav-container-center";
    private const string NAV_CONTAINER_NONE_CLASS = "nav-container-none";

    private MenuItem selectdMenuItem = MenuItem.Work;
    private string navClass = NAV_CONTAINER_CLASS;

    private void MenuItemClick(MenuItem menuItem)
    {
        selectdMenuItem = menuItem;
        StateHasChanged();
        NavigationManager.NavigateTo(GetRouteByMenuItem(menuItem));
    }

    private string GetRouteByMenuItem(MenuItem menuItem)
    {
        switch (menuItem)
        {
            case MenuItem.Work: return string.Empty;
            case MenuItem.About: return "about";
            default: return string.Empty;
        }
    }

    private bool IsActiveMenu(MenuItem menuItem)
    {
        return menuItem == selectdMenuItem;
    }

    private int lastScrollTopValue = 0;
    private int lastShrinkScrollValue = 0;
    private int scrollValue = 0;
    private const int HOLD_SCROLL_LEVEL = 66;
    [JSInvokable]
    public async Task OnScroll()
    {
        var (bodyScrollTopTask, elementScrollTopTask) = (browserService.GetBodyScrollTop<double>(),
            browserService.GetElementScrollTop<double>());
        _ = await Task.WhenAll(bodyScrollTopTask, elementScrollTopTask);
        scrollValue = (int)Math.Max(bodyScrollTopTask.Result, elementScrollTopTask.Result);

        if ((scrollValue - lastShrinkScrollValue) > HOLD_SCROLL_LEVEL
            && lastScrollTopValue < scrollValue)
        {
            if (navClass != NAV_CONTAINER_NONE_CLASS)
            {
                navClass = NAV_CONTAINER_NONE_CLASS;
                StateHasChanged();
            }
        }
        else if (scrollValue < lastScrollTopValue
            && scrollValue > HOLD_SCROLL_LEVEL)
        {
            lastShrinkScrollValue = scrollValue;
            if (navClass != NAV_CONTAINER_CENTER_CLASS)
            {
                navClass = NAV_CONTAINER_CENTER_CLASS;
                StateHasChanged();
            }
        }
        else if (scrollValue < lastScrollTopValue)
        {
            lastShrinkScrollValue = scrollValue;
            if (navClass != NAV_CONTAINER_CLASS)
            {
                navClass = NAV_CONTAINER_CLASS;
                StateHasChanged();
            }
        }
        lastScrollTopValue = scrollValue;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var objRev = DotNetObjectReference.Create(this);
            await jsrunTime.InvokeVoidAsync("setOnScroll", objRev, nameof(OnScroll));
        }
    }
}
